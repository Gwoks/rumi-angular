<div class="activities-container min-h-full">
  <!-- Header -->
  <div class="header-section">
    <div class="flex justify-between items-center mb-6">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">
          {{ isAdmin ? 'All User Activities' : 'My Activities' }}
        </h1>
        <p class="text-gray-600 mt-1">
          {{ isAdmin ? 'Monitor all user activities across the system' : 'View your account activity history' }}
        </p>
      </div>
      <div class="flex items-center space-x-2">
        <span class="text-sm text-gray-500">
          {{ isAdmin ? 'Admin View' : 'User View' }}
        </span>
        <div class="w-3 h-3 rounded-full" [class]="isAdmin ? 'bg-red-500' : 'bg-blue-500'"></div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>

  <!-- Activities List -->
  <div *ngIf="!loading" class="bg-white rounded-lg shadow-sm border">
    <!-- Empty State -->
    <div *ngIf="activities.length === 0" class="text-center py-12">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">No activities</h3>
      <p class="mt-1 text-sm text-gray-500">No activities have been recorded yet.</p>
    </div>

    <!-- Activities Timeline -->
    <div *ngIf="activities.length > 0" class="divide-y divide-gray-200">
      <div *ngFor="let activity of activities" class="p-6 hover:bg-gray-50 transition-colors">
        <div class="flex items-start space-x-4">
          <!-- Activity Icon -->
          <div class="flex-shrink-0">
            <div class="w-10 h-10 rounded-full flex items-center justify-center text-lg" [class]="getActionColor(activity.activity_type)">
              {{ getActionIcon(activity.activity_type) }}
            </div>
          </div>

          <!-- Activity Content -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-900">
                  {{ activity.description }}
                </p>
                <div class="mt-1 flex items-center space-x-4 text-sm text-gray-500">
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium" [class]="getActionColor(activity.activity_type)">
                    {{ formatActivityType(activity.activity_type) }}
                  </span>
                  <span *ngIf="isAdmin && activity.user" class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    {{ activity.user.name }}
                  </span>
                  <span class="flex items-center">
                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    {{ activity.ip_address }}
                  </span>
                </div>
              </div>
              <div class="text-right">
                <p class="text-sm text-gray-900">{{ getRelativeTime(activity.created_at) }}</p>
                <p class="text-xs text-gray-500">{{ formatDate(activity.created_at) }}</p>
              </div>
            </div>

            <!-- User Agent (collapsed by default, expandable) -->
            <div *ngIf="isAdmin" class="mt-2">
              <details class="group">
                <summary class="cursor-pointer text-xs text-gray-400 hover:text-gray-600 transition-colors">
                  <span class="inline-flex items-center">
                    <svg class="w-3 h-3 mr-1 transform group-open:rotate-90 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                    View technical details
                  </span>
                </summary>
                <div class="mt-2 p-3 bg-gray-50 rounded-md">
                  <p class="text-xs text-gray-600 font-mono break-all">
                    <strong>User Agent:</strong> {{ activity.user_agent }}
                  </p>
                  <p class="text-xs text-gray-600 mt-1">
                    <strong>Activity ID:</strong> {{ activity.id }}
                  </p>
                  <p class="text-xs text-gray-600 mt-1" *ngIf="activity.user">
                    <strong>User Email:</strong> {{ activity.user.email }}
                  </p>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div *ngIf="activities.length > 0 && totalPages > 1" class="px-6 py-3 border-t border-gray-200">
      <div class="flex items-center justify-between">
        <div class="text-sm text-gray-700">
          Showing {{ (currentPage - 1) * limit + 1 }} to {{ getDisplayEnd() }} of {{ totalActivities }} activities
        </div>
        <div class="flex gap-1">
          <button 
            (click)="goToPage(currentPage - 1)"
            [disabled]="currentPage === 1"
            class="px-3 py-1 text-sm border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
            Previous
          </button>
          <button 
            *ngFor="let page of getPaginationPages()"
            (click)="goToPage(page)"
            class="px-3 py-1 text-sm border rounded-md hover:bg-gray-50"
            [class]="page === currentPage ? 'bg-blue-600 text-white border-blue-600' : 'text-gray-700'">
            {{ page }}
          </button>
          <button 
            (click)="goToPage(currentPage + 1)"
            [disabled]="currentPage === totalPages"
            class="px-3 py-1 text-sm border rounded-md disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50">
            Next
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Info Card -->
  <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
    <div class="flex items-start">
      <svg class="w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <div>
        <h3 class="text-sm font-medium text-blue-900">Activity Tracking</h3>
        <p class="text-sm text-blue-700 mt-1">
          {{ isAdmin 
            ? 'As an admin, you can view all user activities across the system. This includes login attempts, profile changes, and data modifications.' 
            : 'This page shows your account activity history. All actions you perform are logged for security and audit purposes.' 
          }}
        </p>
      </div>
    </div>
  </div>
</div>
